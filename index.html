<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vplus Pro - × ×™×”×•×œ ×ª×§×¦×™×‘ ×—×›×</title>
    <meta name="theme-color" content="#7367f0">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        body { 
            font-family: system-ui, sans-serif; 
            background: linear-gradient(135deg, #f4f7fa 0%, #e8ecf3 100%); 
            padding-bottom: 240px; 
            min-height: 100vh; 
            transition: background 0.3s; 
            margin: 0; 
        }

        .item-card { 
            background: white; 
            border-radius: 25px; 
            padding: 15px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); 
            display: flex; 
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s, border 0.3s;
        }

        .item-card:active { transform: scale(0.98); }
        .item-number { color: #7367f0; opacity: 0.6; font-size: 0.8em; margin-left: 4px; }

        #searchInput { transition: all 0.3s ease; border: 2px solid transparent; }
        #searchInput:focus { border-color: #7367f0; background: #fff; box-shadow: 0 10px 25px rgba(115, 103, 240, 0.1); outline: none; }

        .bottom-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%);
            z-index: 1000; padding: 15px 15px 35px 15px; 
            border-radius: 35px 35px 0 0; box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.15); 
        }

        .tab-btn { flex: 1; padding: 12px; border-radius: 15px; font-weight: bold; text-align: center; cursor: pointer; transition: 0.2s; background: white; color: #666; border: 1px solid #eee; }
        .tab-active { background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%) !important; color: white !important; box-shadow: 0 4px 12px rgba(115, 103, 240, 0.3); }

        .bottom-circle-btn { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid rgba(255,255,255,0.2); box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.2s; }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 7000; align-items: flex-start; justify-content: center; backdrop-filter: blur(8px); }
        .modal-overlay.active { display: flex; }

        .edit-modal { width: 90%; max-width: 400px; background-color: #ffffff !important; border-radius: 0 0 30px 30px; padding: 20px; text-align: center; color: #333; border: 2px solid #eee; box-shadow: 0 15px 35px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto; }
        .modal-input { width: 100%; padding: 12px; border: 2px solid #f3f4f6; border-radius: 16px; font-size: 16px; text-align: center; outline: none; margin-bottom: 10px; font-weight: bold; background: #f9fafb !important; color: #333; }

        .app-header { background: white; padding: 10px 20px; display: flex; flex-direction: row-reverse; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 2000; height: 60px; }
        .header-controls { display: flex; align-items: center; gap: 8px; direction: rtl; }

        .trash-btn { width: 44px; height: 44px; background: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #ef4444; border: none; cursor: pointer; transition: all 0.2s; }
        .trash-btn:active { background: #ef4444; color: white; }

        .category-separator { background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%); color: white; border-radius: 20px; padding: 15px; margin-bottom: 20px; text-align: center; position: relative; }

        body.dark-mode { background: #1a1a2e; color: #e0e0e0; }
        .dark-mode .app-header { background: #16213e; border-bottom: 1px solid #0f3460; }
        .dark-mode .item-card, .dark-mode .edit-modal { background-color: #0f3460 !important; color: white; }
        .dark-mode .modal-input { background-color: #1a1a2e !important; color: white !important; }

        .notification { position: fixed; top: 70px; right: 20px; background: white; padding: 15px 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 9000; transform: translateX(400px); transition: transform 0.3s ease; }
        .notification.show { transform: translateX(0); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-header no-print">
        <h1 class="font-bold text-2xl" style="direction: ltr;">
            <span style="color: #22c55e;">V</span><span class="text-indigo-600">plus</span><span style="font-size: 10px; color: #9055ff; vertical-align: super;">PRO</span>
        </h1>
        <div class="header-controls">
            <div id="cloudBtn" onclick="handleCloudClick()" class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-[10px] font-bold border border-indigo-100 flex items-center gap-1 cursor-pointer">
                <span>×¡× ×›×¨×•×Ÿ ×¢× ×Ÿ</span>
                <div id="cloudIndicator" class="w-2 h-2 bg-gray-300 rounded-full"></div>
            </div>
            <button onclick="openModal('settingsModal')" class="p-2 rounded-full hover:bg-gray-100">
                <svg class="w-7 h-7 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
            </button>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4 no-print">
        <div class="flex gap-3 mb-6">
            <div id="tabLists" onclick="showPage('lists')" class="tab-btn tab-active">×”×¨×©×™××” ×©×œ×™</div>
            <div id="tabSummary" onclick="showPage('summary')" class="tab-btn">×”×¨×©×™××•×ª ×©×œ×™</div>
            <div id="tabStats" onclick="showPage('stats')" class="tab-btn">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
        </div>

        <div id="pageLists">
            <div class="mb-4 relative">
                <input type="text" id="searchInput" list="itemSuggestions" oninput="handleSearchInput(this.value)" placeholder="×—×¤×© ××•×¦×¨ ×‘×¨×©×™××” ×–×•..." class="w-full p-4 pr-12 rounded-2xl border-none shadow-sm focus:ring-2 focus:ring-indigo-500 text-lg">
                <datalist id="itemSuggestions"></datalist>
                <svg onclick="findItemInList()" class="w-6 h-6 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>

            <div class="flex gap-2 mb-4">
                <button onclick="openModal('newListModal')" class="bg-indigo-600 text-white flex-1 py-3 rounded-xl font-bold">+ ×¨×©×™××” ×—×“×©×”</button>
                <button onclick="openModal('importModal')" class="bg-green-500 text-white flex-1 py-3 rounded-xl font-bold">ğŸ“¥ ×™×™×‘×•×</button>
            </div>

            <div class="category-separator">
                <div class="flex justify-between items-center px-4">
                    <button onclick="shareNative('list')" class="text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                    </button>
                    <div id="listNameDisplay" class="text-xl font-black truncate" onclick="openModal('editListNameModal')"></div>
                    <button onclick="toggleTemplateMode()" class="text-white">â­</button>
                </div>
                <div id="statusTag" class="text-[10px] font-bold mt-1 opacity-80 uppercase">× ×¢×•×œ</div>
            </div>
            <div id="itemsContainer"></div>
        </div>

        <div id="pageSummary" class="hidden">
            <div class="bg-white rounded-2xl p-4 mb-4 shadow-sm border border-gray-100 flex items-center gap-3">
                <input type="checkbox" id="selectAllLists" onchange="toggleSelectAll(this.checked)" class="w-7 h-7 accent-indigo-600">
                <span class="font-bold text-slate-700 flex-1 text-lg">×‘×—×¨ ××ª ×›×œ ×”×¨×©×™××•×ª</span>
                <button onclick="shareNative('summary')" class="text-indigo-600">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                </button>
            </div>
            <div id="summaryContainer"></div>
        </div>

        <div id="pageStats" class="hidden">
            <div class="stat-card">
                <h3 class="font-bold text-xl mb-4">ğŸ“Š ×‘×™×¦×•×¢×™×</h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-green-50 p-4 rounded-2xl"><div class="text-xs text-green-600">×”×•×©×œ××•</div><div id="completedLists" class="text-2xl font-black text-green-700">0</div></div>
                    <div class="bg-blue-50 p-4 rounded-2xl"><div class="text-xs text-blue-600">×××•×¦×¢</div><div id="avgPerList" class="text-2xl font-black text-blue-700">â‚ª0</div></div>
                </div>
                <canvas id="monthlyChart" height="200"></canvas>
            </div>
            <div class="stat-card mt-4">
                <h3 class="font-bold text-xl mb-4">ğŸ“ ×”×™×¡×˜×•×¨×™×”</h3>
                <div id="historyContent" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <div class="bottom-bar text-white no-print">
        <div class="flex items-center justify-between mb-4">
            <div class="flex-1 text-center"><div class="text-[10px] opacity-70">×¡×”"×›</div><div class="text-xl font-bold">â‚ª<span id="displayTotal">0.00</span></div></div>
            <div class="flex-shrink-0"><button onclick="openModal('inputForm')" class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center shadow-2xl border-4 border-white/20 text-4xl font-bold">+</button></div>
            <div class="flex-1 text-center"><div class="text-[10px] opacity-70">×©×•×œ×</div><div class="text-xl font-bold">â‚ª<span id="displayPaid">0.00</span></div></div>
        </div>
        <div class="flex items-center justify-between gap-4">
            <button id="mainLockBtn" onclick="toggleLock()" class="bottom-circle-btn bg-blue-600">ğŸ”’</button>
            <div class="text-center flex-1">
                <div class="text-[10px] opacity-70">× ×©××¨</div>
                <div class="text-2xl font-black text-orange-300">â‚ª<span id="displayLeft">0.00</span></div>
            </div>
            <button onclick="openModal('confirmModal')" class="bottom-circle-btn bg-red-500 text-xl font-bold">V</button>
        </div>
    </div>

    <div id="inputForm" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold mb-4">×”×•×¡×¤×ª ××•×¦×¨</h2>
        <input type="text" id="itemName" placeholder="×©× ×”××•×¦×¨" class="modal-input">
        <input type="number" id="itemPrice" placeholder="××—×™×¨" class="modal-input">
        <div class="flex gap-3"><button class="bg-green-500 text-white flex-1 py-4 rounded-xl font-bold" onclick="addItem()">×”×•×¡×£</button><button onclick="closeModal('inputForm')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="newListModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold mb-4">×¨×©×™××” ×—×“×©×”</h2>
        <input type="text" id="newListNameInput" placeholder="×©× ×”×¨×©×™××”" class="modal-input">
        <label class="flex items-center gap-2 justify-center mb-4"><input type="checkbox" id="newListTemplate"> ×©××•×¨ ×›×ª×‘× ×™×ª</label>
        <div class="flex gap-3"><button class="bg-indigo-600 text-white flex-1 py-4 rounded-xl font-bold" onclick="saveNewList()">×¦×•×¨</button><button onclick="closeModal('newListModal')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="confirmModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="text-green-600 font-bold mb-4">×¡×™×•× ×¨×©×™××”?</h2>
        <p class="mb-6 text-gray-500">×”××•×¦×¨×™× ×™×•×¢×‘×¨×• ×œ×”×™×¡×˜×•×¨×™×” ×•×”×¨×©×™××” ×”× ×•×›×—×™×ª ×ª×ª× ×§×”.</p>
        <div class="flex gap-3"><button class="bg-green-500 text-white flex-1 py-4 rounded-xl font-bold" onclick="completeList()">×›×Ÿ, ×”×©×œ×</button><button onclick="closeModal('confirmModal')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="settingsModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold mb-6">×”×’×“×¨×•×ª</h2>
        <button onclick="toggleDarkMode()" class="w-full bg-indigo-50 text-indigo-600 py-4 rounded-2xl font-bold mb-3">××¦×‘ ×œ×™×œ×” ğŸŒ™</button>
        <button onclick="preparePrint()" class="w-full bg-orange-500 text-white py-4 rounded-2xl font-bold mb-3">×”×“×¤×¡ PDF ğŸ–¨ï¸</button>
        <button onclick="exportData()" class="w-full bg-blue-500 text-white py-4 rounded-2xl font-bold mb-3">ğŸ’¾ ×’×™×‘×•×™ × ×ª×•× ×™×</button>
        <button onclick="document.getElementById('fileIn').click()" class="w-full bg-purple-500 text-white py-4 rounded-2xl font-bold">ğŸ“‚ ×©×—×–×•×¨ × ×ª×•× ×™×</button>
        <input type="file" id="fileIn" class="hidden" onchange="importData(event)">
        <button onclick="closeModal('settingsModal')" class="mt-6 text-gray-400 block w-full">×¡×’×•×¨</button>
    </div></div>

    <div id="importModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold mb-4">×™×™×‘×•× ××”×™×¨</h2>
        <textarea id="importText" placeholder="×”×“×‘×§ ×¨×©×™××” ×›××Ÿ..." class="modal-input h-32"></textarea>
        <button class="bg-green-500 text-white w-full py-4 rounded-xl font-bold" onclick="importFromText()">×™×™×‘×</button>
    </div></div>

    <div id="editListNameModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold mb-4">×¢×¨×™×›×ª ×©× ×¨×©×™××”</h2>
        <input type="text" id="editListNameInput" class="modal-input">
        <div class="flex gap-3"><button class="bg-indigo-600 text-white flex-1 py-4 rounded-xl font-bold" onclick="saveListName()">×©××•×¨</button><button onclick="closeModal('editListNameModal')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="printArea" class="hidden"></div>
    <script src="script.js"></script>
</body>
</html>

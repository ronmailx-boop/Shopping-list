<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vplus - ניהול תקציב חכם</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#7367f0">
    <link rel="apple-touch-icon" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <div class="sticky top-0 bg-white shadow-md z-50 px-5 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <button id="cloudBtn" onclick="handleCloudSync()" class="text-3xl">☁️</button>
            <button onclick="openModal('settingsModal')" class="text-3xl">⚙️</button>
        </div>
        <div class="flex items-center gap-2">
            <span class="text-2xl font-bold text-indigo-600">V</span>
            <span class="text-xl font-semibold text-gray-700">plus</span>
        </div>
    </div>

    <!-- Page: Lists -->
    <div id="pageLists" class="px-4 py-4">
        <div class="flex items-center justify-between mb-4">
            <button onclick="openModal('deleteListModal')" class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold">🗑️ מחק רשימה</button>
            <h2 id="listNameDisplay" onclick="openModal('editListNameModal')" class="text-2xl font-bold text-indigo-600 cursor-pointer">הרשימה שלי</h2>
        </div>
        <div id="itemsContainer"></div>
    </div>

    <!-- Page: Summary -->
    <div id="pageSummary" class="hidden px-4 py-4">
        <h2 class="text-center text-2xl font-bold text-indigo-600 mb-5">הרשימות שלי</h2>
        <button onclick="openModal('newListModal')" class="w-full bg-green-500 text-white py-4 rounded-2xl text-lg font-bold mb-5 shadow-lg">+ רשימה חדשה</button>
        
        <div class="bg-white rounded-2xl p-4 mb-4 shadow flex items-center gap-3">
            <label for="selectAll" class="flex-1 font-bold text-gray-700 cursor-pointer" id="selectAllLabel">בחר את כל הרשימות</label>
            <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this.checked)" class="w-6 h-6 cursor-pointer">
        </div>
        
        <div id="summaryContainer"></div>
    </div>

    <!-- Bottom Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-indigo-600 rounded-t-[35px] shadow-2xl px-4 pb-8 pt-4 z-40">
        <div class="flex items-center justify-between mb-3">
            <div class="flex gap-3">
                <button id="mainLockBtn" onclick="toggleLock()" class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center shadow-lg border-2 border-white/20">
                    <svg class="w-6 h-6" fill="white" viewBox="0 0 24 24">
                        <path id="lockIconPath" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                </button>
                <button onclick="openClearModal()" class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center shadow-lg border-2 border-white/20">
                    <svg class="w-6 h-6" fill="white" viewBox="0 0 24 24">
                        <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </div>
            <span id="statusTag" class="bg-white/20 px-4 py-2 rounded-2xl text-sm font-bold text-white">נעול</span>
            <button onclick="openModal('inputForm')" class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center shadow-2xl">
                <svg class="w-8 h-8" fill="white" viewBox="0 0 24 24">
                    <path d="M12 4v16m8-8H4"/>
                </svg>
            </button>
        </div>

        <div class="grid grid-cols-3 gap-2 bg-white/10 p-3 rounded-2xl mb-3">
            <div class="text-center">
                <div class="text-xs text-white/80 mb-1">סה"כ רשימה</div>
                <div id="totalAmount" class="text-xl font-bold text-white">₪0.00</div>
            </div>
            <div class="text-center">
                <div class="text-xs text-white/80 mb-1">שולם ברשימה</div>
                <div id="paidAmount" class="text-xl font-bold text-green-300">₪0.00</div>
            </div>
            <div class="text-center">
                <div class="text-xs text-white/80 mb-1">נשאר לשלם</div>
                <div id="remainingAmount" class="text-xl font-bold text-yellow-300">₪0.00</div>
            </div>
        </div>

        <div class="flex gap-2">
            <button id="tabLists" onclick="showPage('lists')" class="flex-1 bg-white text-gray-700 py-3 rounded-2xl font-bold transition-all">הרשימה שלי</button>
            <button id="tabSummary" onclick="showPage('summary')" class="flex-1 bg-white/20 text-white py-3 rounded-2xl font-bold transition-all">הרשימות שלי</button>
        </div>
    </div>

    <!-- Modal: Add Item -->
    <div id="inputForm" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-indigo-600 mb-5">הוספת מוצר</h2>
            <input id="itemName" type="text" placeholder="שם המוצר" class="modal-input">
            <input id="itemPrice" type="number" step="0.01" placeholder="מחיר" class="modal-input">
            <div class="flex gap-3 mt-4">
                <button onclick="addItem()" class="flex-1 bg-green-500 text-white py-4 rounded-2xl font-bold">הוסף</button>
                <button onclick="closeModal('inputForm')" class="flex-1 bg-gray-400 text-white py-4 rounded-2xl font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Modal: New List -->
    <div id="newListModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-indigo-600 mb-5">רשימה חדשה</h2>
            <input id="newListName" type="text" placeholder="שם הרשימה" class="modal-input">
            <div class="flex gap-3 mt-4">
                <button onclick="createNewList()" class="flex-1 bg-green-500 text-white py-4 rounded-2xl font-bold">צור</button>
                <button onclick="closeModal('newListModal')" class="flex-1 bg-gray-400 text-white py-4 rounded-2xl font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Modal: Clear Items -->
    <div id="clearModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-red-500 mb-5">ניקוי מוצרים</h2>
            <p class="text-gray-600 mb-5">למחוק את כל המוצרים?</p>
            <div class="flex gap-3">
                <button onclick="clearItems()" class="flex-1 bg-red-500 text-white py-4 rounded-2xl font-bold">נקה</button>
                <button onclick="closeModal('clearModal')" class="flex-1 bg-gray-400 text-white py-4 rounded-2xl font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Modal: Delete List -->
    <div id="deleteListModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-red-500 mb-5">מחיקת רשימה</h2>
            <div class="flex gap-3">
                <button onclick="deleteCurrentList()" class="flex-1 bg-red-500 text-white py-4 rounded-2xl font-bold">מחק</button>
                <button onclick="closeModal('deleteListModal')" class="flex-1 bg-gray-400 text-white py-4 rounded-2xl font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Modal: Edit List Name -->
    <div id="editListNameModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-indigo-600 mb-5">שינוי שם</h2>
            <input id="editListNameInput" type="text" class="modal-input">
            <div class="flex gap-3 mt-4">
                <button onclick="saveListName()" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-bold">שמור</button>
                <button onclick="closeModal('editListNameModal')" class="flex-1 bg-gray-400 text-white py-4 rounded-2xl font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Modal: Edit Price -->
    <div id="editPriceModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-indigo-600 mb-5">עדכון מחיר</h2>
            <input id="editPriceInput" type="number" step="0.01" class="modal-input">
            <div class="flex gap-3 mt-4">
                <button onclick="savePrice()" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-bold">עדכן</button>
                <button onclick="closeModal('editPriceModal')" class="flex-1 bg-gray-400 text-white py-4 rounded-2xl font-bold">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Modal: Settings -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-indigo-600 mb-5">הגדרות</h2>
            <button onclick="toggleDarkMode()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold mb-3">מצב לילה 🌙</button>
            <button onclick="printList()" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold mb-3">הדפס PDF 🖨️</button>
            <button onclick="closeModal('settingsModal')" class="w-full bg-gray-400 text-white py-4 rounded-xl font-bold">סגור</button>
        </div>
    </div>

    <!-- Modal: Share List -->
    <div id="shareListModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-green-500 mb-5">מה לשלוח ב-WhatsApp?</h2>
            <button onclick="shareAllToWhatsApp()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold mb-3 shadow-md">שיתוף רשימה מלאה 📋</button>
            <button onclick="shareMissingToWhatsApp()" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold mb-4 shadow-md">שיתוף מוצרים חסרים בלבד ⬜</button>
            <button onclick="closeModal('shareListModal')" class="text-gray-400 font-bold block w-full mt-2">ביטול</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js')
          .then(function(registration) {
            console.log('✅ Service Worker registered successfully');
          })
          .catch(function(error) {
            console.log('❌ Service Worker registration failed:', error);
          });
      });
    }
    </script>
</body>
</html>
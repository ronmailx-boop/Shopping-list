<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>vplus -  转拽爪 </title>
    <meta name="theme-color" content="#7367f0">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #f4f7fa 0%, #e8ecf3 100%); padding-bottom: 240px; min-height: 100vh; transition: background 0.3s; margin: 0; }
        .item-card { background: white; border-radius: 25px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03); display: flex; flex-direction: column; transition: transform 0.2s, box-shadow 0.2s; }
        .item-card:active { transform: scale(0.98); }
        .item-number { color: #7367f0; opacity: 0.6; font-size: 0.8em; margin-left: 4px; }
        #searchInput { transition: all 0.3s ease; border: 2px solid transparent; }
        #searchInput:focus { border-color: #7367f0; background: #fff; box-shadow: 0 10px 25px rgba(115, 103, 240, 0.1); outline: none; }
        .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%); z-index: 1000; padding: 15px 15px 35px 15px; border-radius: 35px 35px 0 0; box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.15); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .bottom-bar.minimized { transform: translateY(calc(100% - 8px)); }
        .tab-btn { flex: 1; padding: 12px; border-radius: 15px; font-weight: bold; text-align: center; cursor: pointer; transition: 0.2s; background: white; color: #666; border: 1px solid #eee; }
        .tab-active { background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%) !important; color: white !important; box-shadow: 0 4px 12px rgba(115, 103, 240, 0.3); }
        .bottom-circle-btn { width: 48px !important; height: 48px !important; flex-shrink: 0 !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2) !important; cursor: pointer; transition: transform 0.2s; }
        .bottom-circle-btn:active { transform: scale(0.95); }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); z-index: 7000; align-items: flex-start; justify-content: center; backdrop-filter: blur(8px); padding-top: 0; }
        .modal-overlay.active { display: flex; }
        .edit-modal { width: 90%; max-width: 400px; background-color: #ffffff !important; border-radius: 0 0 30px 30px; padding: 6px 25px; text-align: center; color: #333; border: 2px solid #eee; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3); max-height: 90vh; overflow-y: auto; }
        .modal-input { width: 100%; padding: 6px; border: 2px solid #f3f4f6; border-radius: 16px; font-size: 16px; text-align: center; outline: none; margin-bottom: 5px; font-weight: bold; background: #f9fafb !important; color: #333; }
        .edit-modal h2 { margin-top: 2px; margin-bottom: 8px; font-size: 1.15rem; }
        .app-header { background: white; padding: 10px 20px; display: flex; flex-direction: row-reverse; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); position: sticky; top: 0; z-index: 2000; height: 60px; }
        .header-controls { display: flex; align-items: center; gap: 8px; direction: rtl; }
        .gear-btn { flex-shrink: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .trash-btn { width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #ef4444; border: none; cursor: pointer; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        .category-separator { background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%); color: white; border-radius: 20px; padding: 15px; margin-bottom: 20px; text-align: center; }
        .category-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: bold; margin: 2px; }
        .stat-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); margin-bottom: 15px; }
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 10px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%); border-radius: 10px; transition: width 0.3s ease; }
        body.dark-mode { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #e0e0e0; }
        .dark-mode .app-header { background: #16213e; border-bottom: 1px solid #0f3460; }
        .dark-mode .item-card, .dark-mode .bg-white, .dark-mode .stat-card { background-color: #0f3460 !important; border-color: #1a1a2e; color: white; }
        .dark-mode #selectAllLabel { color: white !important; }
        .dark-mode .select-all-container { background-color: #0f3460 !important; }
        .dark-mode #searchInput { background-color: #0f3460 !important; color: white; }
        .dark-mode .item-number { color: #a5a2f7; }
        .dark-mode .item-card span.font-bold { color: white !important; }
        .dark-mode .item-card .bg-gray-50 { background-color: rgba(255, 255, 255, 0.1) !important; border-color: rgba(255, 255, 255, 0.2); }
        .dark-mode .modal-input { background-color: #0f3460 !important; color: white !important; border-color: #1a1a2e; }
        .dark-mode .edit-modal { background-color: #16213e !important; color: white; border-color: #0f3460; }
        @media print { .no-print, .bottom-bar, .app-header, .tab-btn, .modal-overlay, .trash-btn, input, button { display: none !important; } #printArea { display: block !important; width: 100%; direction: rtl; } }
        .notification { position: fixed; top: 70px; right: 20px; background: white; padding: 15px 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); z-index: 9000; transform: translateX(400px); transition: transform 0.3s ease; }
        .notification.show { transform: translateX(0); }
        .floating-toggle-btn { position: fixed; bottom: 220px; right: 10px; width: 35px; height: 35px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 1001; transition: all 0.3s ease; border: 2px solid rgba(115, 103, 240, 0.3); }
        .floating-toggle-btn:active { transform: scale(0.9); }
        .floating-toggle-btn svg { transition: transform 0.3s ease; color: #7367f0; }
        .floating-toggle-btn.bar-hidden { bottom: 10px; }
        .floating-toggle-btn.bar-hidden svg { transform: rotate(180deg); }
        .template-badge { background: #fbbf24; color: white; padding: 2px 8px; border-radius: 8px; font-size: 10px; font-weight: bold; margin-right: 8px; }
        .autocomplete-container { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-top: none; border-radius: 0 0 16px 16px; max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .autocomplete-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #f3f4f6; transition: background 0.2s; }
        .autocomplete-item:hover { background: #f9fafb; }
        .autocomplete-item:last-child { border-bottom: none; }
        .cloud-btn-connected { background: #dcfce7 !important; color: #15803d !important; border-color: #86efac !important; }
        .cloud-btn-disconnected { background: #f3f4f6; color: #6b7280; border-color: #e5e7eb; }
        .error-modal { width: 90%; max-width: 450px; background-color: #ffffff !important; border-radius: 20px; padding: 25px; text-align: right; color: #333; border: 3px solid #ef4444; box-shadow: 0 20px 50px rgba(239, 68, 68, 0.3); max-height: 85vh; overflow-y: auto; animation: errorSlideIn 0.4s ease-out; }
        body.dark-mode .error-modal { background: #1e293b !important; color: #e2e8f0; border-color: #ef4444; }
        @keyframes errorSlideIn { from { opacity: 0; transform: translateY(-30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .error-icon { font-size: 3.5em; text-align: center; margin-bottom: 15px; animation: errorPulse 1s ease-in-out infinite; }
        @keyframes errorPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .error-title { font-size: 1.4em; font-weight: 900; color: #ef4444; margin-bottom: 15px; text-align: center; }
        body.dark-mode .error-title { color: #fca5a5; }
        .error-message { background: #fef2f2; border-radius: 15px; padding: 15px; margin-bottom: 20px; font-size: 0.95em; line-height: 1.6; white-space: pre-line; border-right: 4px solid #ef4444; text-align: right; }
        body.dark-mode .error-message { background: #7f1d1d; color: #fecaca; border-color: #ef4444; }
        .error-code { font-family: 'Courier New', monospace; background: #fee; padding: 8px 12px; border-radius: 8px; font-size: 0.85em; color: #991b1b; margin-top: 10px; text-align: center; border: 1px dashed #ef4444; }
        body.dark-mode .error-code { background: #450a0a; color: #fca5a5; }
    </style>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW fail', err));
            });
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithRedirect, GoogleAuthProvider, getRedirectResult, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        try {
            const firebaseConfig = { 
                apiKey: "AIzaSyBqIqxoiwwqeKkjlYJpEiqgCG09PgabwhI", 
                authDomain: "vplus-pro.firebaseapp.com", // 转拽
                projectId: "vplus-pro", 
                storageBucket: "vplus-pro.firebasestorage.app", 
                messagingSenderId: "386740827706", 
                appId: "1:386740827706:web:a3c95c895826df4bb26703" 
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const provider = new GoogleAuthProvider();

            window.firebaseAuth = auth;
            window.firebaseDb = db;
            window.googleProvider = provider;
            window.signInWithRedirect = signInWithRedirect;
            window.getRedirectResult = getRedirectResult;
            window.signOut = signOut;
            window.onAuthStateChanged = onAuthStateChanged;
            window.doc = doc;
            window.setDoc = setDoc;
            window.onSnapshot = onSnapshot;
            window.getDoc = getDoc;

            getRedirectResult(auth).then((result) => {
                if (result?.user) console.log('专:', result.user.email);
            }).catch((err) => alert('砖: ' + err.code));
        } catch (e) { console.error(e); }
    </script>
</head>

<body>
    <div id="firebaseErrorModal" class="modal-overlay">
        <div class="error-modal">
            <div class="error-icon">锔</div>
            <h2 class="error-title" id="firebaseErrorTitle">砖</h2>
            <div class="error-message" id="firebaseErrorMessage">转专 砖 驻注 </div>
            <button onclick="document.getElementById('firebaseErrorModal').classList.remove('active')" class="w-full bg-red-500 text-white py-3 rounded-xl font-bold">住专</button>
        </div>
    </div>

    <div class="app-header no-print">
        <h1 class="font-bold text-2xl" style="direction: ltr;"><span style="color: #22c55e !important;">V</span><span class="text-indigo-600">plus</span><span style="font-size: 10px; color: #9055ff; vertical-align: super;">PRO</span></h1>
        <div class="header-controls">
            <div id="cloudBtn" class="cloud-btn-disconnected px-3 py-1 rounded-full text-[10px] font-bold border flex items-center gap-1 cursor-pointer transition-all">
                <span id="cloudSyncText">住专 注</span>
                <div id="cloudIndicator" class="w-2 h-2 bg-gray-400 rounded-full"></div>
            </div>
            <button onclick="openModal('settingsModal')" class="p-2 rounded-full hover:bg-gray-100 gear-btn">
                <svg class="w-7 h-7 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            </button>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4 no-print">
        <div class="flex gap-3 mb-6">
            <div id="tabLists" onclick="showPage('lists')" class="tab-btn tab-active">专砖 砖</div>
            <div id="tabSummary" onclick="showPage('summary')" class="tab-btn">专砖转 砖</div>
            <div id="tabStats" onclick="showPage('stats')" class="tab-btn"> 住住拽转</div>
        </div>
        <div id="pageLists">
            <div class="lists-header-card bg-white p-2 rounded-2xl border border-gray-100 shadow-sm mb-4">
                <div class="flex gap-2">
                    <button onclick="openModal('newListModal')" class="bg-indigo-600 text-white flex-1 py-3 rounded-xl font-bold">+ 专砖 砖</button>
                    <button onclick="openModal('importModal')" class="bg-green-500 text-white flex-1 py-3 rounded-xl font-bold"> </button>
                    <button onclick="openModal('receiptScanModal')" class="bg-blue-500 text-white flex-1 py-3 rounded-xl font-bold"> 住专拽 拽</button>
                </div>
            </div>
            <div id="itemsContainer"></div>
        </div>
        </div>
    
    <script src="script.js"></script>
</body>
</html>

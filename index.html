<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vplus Pro - × ×™×”×•×œ ×ª×§×¦×™×‘ ×—×›×</title>
    <meta name="theme-color" content="#7367f0">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        body { 
            font-family: system-ui, sans-serif; 
            background: linear-gradient(135deg, #f4f7fa 0%, #e8ecf3 100%); 
            padding-bottom: 240px; 
            min-height: 100vh; 
            margin: 0; 
            transition: background 0.3s;
        }

        .item-card { 
            background: white; 
            border-radius: 25px; 
            padding: 15px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); 
            display: flex; 
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .bottom-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%);
            z-index: 1000; padding: 15px 15px 35px 15px; 
            border-radius: 35px 35px 0 0; box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.15); 
        }

        .tab-btn { flex: 1; padding: 12px; border-radius: 15px; font-weight: bold; text-align: center; cursor: pointer; background: white; color: #666; border: 1px solid #eee; }
        .tab-active { background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%) !important; color: white !important; }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 7000; align-items: flex-start; justify-content: center; backdrop-filter: blur(8px); }
        .modal-overlay.active { display: flex; }
        .edit-modal { width: 90%; max-width: 400px; background: white; border-radius: 0 0 30px 30px; padding: 20px; text-align: center; max-height: 90vh; overflow-y: auto; }

        .modal-input { width: 100%; padding: 12px; border: 2px solid #f3f4f6; border-radius: 16px; margin-bottom: 10px; text-align: center; font-weight: bold; outline: none; }

        .app-header { background: white; padding: 10px 20px; display: flex; flex-direction: row-reverse; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 2000; height: 60px; }

        .category-separator { background: linear-gradient(135deg, #7367f0 0%, #9055ff 100%); color: white; border-radius: 20px; padding: 15px; margin-bottom: 20px; text-align: center; }

        body.dark-mode { background: #1a1a2e; color: #e0e0e0; }
        .dark-mode .bg-white, .dark-mode .app-header, .dark-mode .edit-modal { background-color: #16213e !important; color: white; }
        .dark-mode .item-card { background-color: #0f3460 !important; }
        .dark-mode .modal-input { background-color: #1a1a2e !important; color: white; border-color: #0f3460; }

        .notification { position: fixed; top: 70px; right: 20px; background: white; padding: 15px 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 9000; transform: translateX(400px); transition: transform 0.3s; }
        .notification.show { transform: translateX(0); }

        .hidden { display: none; }
        .trash-btn { font-size: 1.2rem; cursor: pointer; padding: 5px; }
    </style>
</head>
<body>

    <div class="app-header no-print">
        <h1 class="font-bold text-2xl" style="direction: ltr;">
            <span style="color: #22c55e;">V</span><span class="text-indigo-600">plus</span><span style="font-size: 10px; color: #9055ff; vertical-align: super;">PRO</span>
        </h1>
        <div class="header-controls flex items-center gap-2">
            <div id="cloudBtn" onclick="handleCloudClick()" class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-[10px] font-bold border border-indigo-100 cursor-pointer flex items-center gap-1">
                <span>×¡× ×›×¨×•×Ÿ ×¢× ×Ÿ</span>
                <div id="cloudIndicator" class="w-2 h-2 bg-gray-300 rounded-full"></div>
            </div>
            <button onclick="openModal('settingsModal')" class="p-2"><svg class="w-7 h-7 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg></button>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4 no-print">
        <div class="flex gap-3 mb-6">
            <div id="tabLists" onclick="showPage('lists')" class="tab-btn tab-active">×”×¨×©×™××” ×©×œ×™</div>
            <div id="tabSummary" onclick="showPage('summary')" class="tab-btn">×”×¨×©×™××•×ª ×©×œ×™</div>
            <div id="tabStats" onclick="showPage('stats')" class="tab-btn">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
        </div>

        <div id="pageLists">
            <div class="mb-4 relative">
                <input type="text" id="searchInput" list="itemSuggestions" oninput="handleSearchInput(this.value)" placeholder="×—×¤×© ××•×¦×¨ ×‘×¨×©×™××” ×–×•..." class="w-full p-4 pr-12 rounded-2xl border-none shadow-sm focus:ring-2 focus:ring-indigo-500 text-lg">
                <datalist id="itemSuggestions"></datalist>
            </div>
            <div class="flex gap-2 mb-4">
                <button onclick="openModal('newListModal')" class="bg-indigo-600 text-white flex-1 py-3 rounded-xl font-bold">+ ×¨×©×™××” ×—×“×©×”</button>
                <button onclick="openModal('importModal')" class="bg-green-500 text-white flex-1 py-3 rounded-xl font-bold">ğŸ“¥ ×™×™×‘×•×</button>
            </div>
            <div class="category-separator">
                <div class="flex justify-between items-center px-4">
                    <button onclick="shareNative('list')" class="text-xl">ğŸ“¤</button>
                    <div id="listNameDisplay" class="text-xl font-black">×˜×•×¢×Ÿ...</div>
                    <button onclick="showNotification('â­ ×ª×›×•× ×” ×–×• ×ª×ª×•×•×¡×£ ×‘×§×¨×•×‘')" class="text-xl">â­</button>
                </div>
                <div id="statusTag" class="text-[10px] font-bold mt-1 opacity-80 uppercase tracking-widest">× ×¢×•×œ</div>
            </div>
            <div id="itemsContainer"></div>
        </div>

        <div id="pageSummary" class="hidden">
            <div class="bg-white rounded-2xl p-4 mb-4 shadow-sm border border-gray-100 flex items-center gap-3">
                <input type="checkbox" id="selectAllLists" onchange="toggleSelectAll(this.checked)" class="w-7 h-7 accent-indigo-600">
                <span class="font-bold text-slate-700 flex-1">×‘×—×¨ ××ª ×›×œ ×”×¨×©×™××•×ª</span>
                <button onclick="shareNative('summary')" class="text-indigo-600 font-bold">×©×ª×£ ×—×¡×¨×™×</button>
            </div>
            <div id="summaryContainer"></div>
        </div>

        <div id="pageStats" class="hidden">
            <div class="bg-white p-6 rounded-3xl shadow-sm mb-4">
                <h3 class="font-bold text-xl mb-4">ğŸ“Š ×‘×™×¦×•×¢×™× ×›×œ×œ×™×™×</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-green-50 p-4 rounded-2xl"><div class="text-xs text-green-600">×”×•×©×œ××•</div><div id="completedLists" class="text-2xl font-black text-green-700">0</div></div>
                    <div class="bg-blue-50 p-4 rounded-2xl"><div class="text-xs text-blue-600">×××•×¦×¢</div><div id="avgPerList" class="text-2xl font-black text-blue-700">â‚ª0</div></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm">
                <h3 class="font-bold text-xl mb-4">ğŸ“ ×”×™×¡×˜×•×¨×™×™×ª ×§× ×™×•×ª</h3>
                <div id="historyContent" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <div class="bottom-bar text-white no-print">
        <div class="flex items-center justify-between mb-4 px-2">
            <div class="text-center"><div class="text-[10px] opacity-70">×¡×”"×›</div><div class="text-xl font-bold">â‚ª<span id="displayTotal">0.00</span></div></div>
            <button onclick="openModal('inputForm')" class="w-16 h-16 bg-green-500 rounded-full text-4xl font-bold shadow-2xl border-4 border-white/20">+</button>
            <div class="text-center"><div class="text-[10px] opacity-70">×©×•×œ×</div><div class="text-xl font-bold">â‚ª<span id="displayPaid">0.00</span></div></div>
        </div>
        <div class="flex items-center justify-between gap-4 px-2">
            <button id="mainLockBtn" onclick="toggleLock()" class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center">ğŸ”’</button>
            <div class="text-center flex-1">
                <div class="text-[10px] opacity-70">× ×©××¨ ×œ×ª×©×œ×•×</div>
                <div class="text-2xl font-black text-orange-300">â‚ª<span id="displayLeft">0.00</span></div>
            </div>
            <button onclick="openModal('confirmModal')" class="w-12 h-12 rounded-full bg-red-500 flex items-center justify-center font-bold text-xl">V</button>
        </div>
    </div>

    <div id="inputForm" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold text-lg mb-4">×”×•×¡×¤×ª ××•×¦×¨</h2>
        <input type="text" id="itemName" placeholder="××” ×§×•× ×™×?" class="modal-input">
        <input type="number" id="itemPrice" inputmode="decimal" placeholder="×›××” ×–×” ×¢×•×œ×”?" class="modal-input">
        <div class="flex gap-3 mt-4"><button class="bg-green-500 text-white flex-1 py-4 rounded-xl font-bold" onclick="addItem()">×”×•×¡×£</button><button onclick="closeModal('inputForm')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="newListModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold text-lg mb-4">×¨×©×™××” ×—×“×©×”</h2>
        <input type="text" id="newListNameInput" placeholder="×©× ×”×¨×©×™××” (×œ××©×œ: ×¡×•×¤×¨)" class="modal-input">
        <label class="flex items-center gap-2 justify-center mb-4"><input type="checkbox" id="newListTemplate" class="w-5 h-5"> ×©××•×¨ ×›×ª×‘× ×™×ª</label>
        <div class="flex gap-3"><button class="bg-indigo-600 text-white flex-1 py-4 rounded-xl font-bold" onclick="saveNewList()">×¦×•×¨</button><button onclick="closeModal('newListModal')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="confirmModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="text-green-600 font-bold text-xl mb-4">×¡×™×™××ª ××ª ×”×§× ×™×™×”?</h2>
        <p class="mb-6 text-gray-500">×”××•×¦×¨×™× ×™×•×¢×‘×¨×• ×œ×”×™×¡×˜×•×¨×™×” ×•×”×¨×©×™××” ×”× ×•×›×—×™×ª ×ª×ª× ×§×”.</p>
        <div class="flex gap-3"><button class="bg-green-500 text-white flex-1 py-4 rounded-xl font-bold" onclick="completeList()">×›×Ÿ, ×”×©×œ×</button><button onclick="closeModal('confirmModal')" class="bg-gray-100 flex-1 py-4 rounded-xl">×‘×™×˜×•×œ</button></div>
    </div></div>

    <div id="settingsModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold text-lg mb-6">×”×’×“×¨×•×ª</h2>
        <button onclick="toggleDarkMode()" class="w-full bg-indigo-50 text-indigo-600 py-4 rounded-2xl font-bold mb-3">××¦×‘ ×œ×™×œ×” ğŸŒ™</button>
        <button onclick="preparePrint()" class="w-full bg-orange-500 text-white py-4 rounded-2xl font-bold mb-3">×”×“×¤×¡ PDF ğŸ–¨ï¸</button>
        <button onclick="exportData()" class="w-full bg-blue-500 text-white py-4 rounded-2xl font-bold mb-3">ğŸ’¾ ×’×™×‘×•×™ × ×ª×•× ×™×</button>
        <button onclick="document.getElementById('fileIn').click()" class="w-full bg-purple-500 text-white py-4 rounded-2xl font-bold">ğŸ“‚ ×©×—×–×•×¨ × ×ª×•× ×™×</button>
        <input type="file" id="fileIn" class="hidden" onchange="importData(event)">
        <button onclick="closeModal('settingsModal')" class="mt-6 text-gray-400 block w-full">×¡×’×•×¨</button>
    </div></div>

    <div id="importModal" class="modal-overlay no-print"><div class="edit-modal">
        <h2 class="font-bold text-lg mb-4">×™×™×‘×•× ××”×™×¨</h2>
        <textarea id="importText" placeholder="×”×“×‘×§ ×¨×©×™××ª ×©×•×¨×•×ª ×›××Ÿ..." class="modal-input h-32"></textarea>
        <button class="bg-green-500 text-white w-full py-4 rounded-xl font-bold" onclick="importFromText()">×™×™×‘× ×¢×›×©×™×•</button>
    </div></div>

    <div id="printArea" class="hidden"></div>
    <script src="script.js"></script>
</body>
</html>
